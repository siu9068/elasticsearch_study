## 2.1 엘라스틱서치를 구성하는 개념

### 2.1.1 기본용어
~~~
엘라스틱서치의 구조
index -> type -> Documnet -> Field
~~~
- 인덱스
  - 인덱스는 데이터 저장공간이다.  
  하나의 인덱스는 하나의 타입만 가지며 하나의 물리적인 노드에 여러개의논리적인 인덱스를 생성할 수 있다.  
  검색 시 인덱스 이름으로 문서 데이터를 검색하며, 여러 개의 인덱스를 동시에 검색하는 것도 가능하다.  
  인덱스의 이름은 모두 소문자여야 하며 추가,수정,삭제,검색은 RESTful API로 수행가능하다.  
  만약에 인덱스가 없는상태에서 데이터가 추가된다면 데이터를 이용해 인덱스가 자동으로 생성된다.
- 샤드
  - 색인된 문서는 하나의 인덱스에 담긴다.  
  인덱스 내부에 색인된 데이터는 물리적인 공간에 여러개의 파티션으로 나뉘어 구성되는데, 이 파티션을 샤드라고 부른다.  
  엘라스틱서치는 다수의 샤드로 문서를 분산 저장하고 있어 데이터 손실 위험을 최소화할 수 있다.
- 타입
  - 타입은 인덱스의 논리적 구조를 의미하며, 인덱스 속성에 따라 분류하기도 한다.  
  장르별로 별도의 인덱스를 각각 생성해서 사용하는 것을 권장한다.
- 문서
  - 문서(Document)는 엘라스틱서치에서 데이터가 저장되는 최소 단위다.  
  json포맷으로 데이터가 저장된다. 하나의 Document는 다수의 필드로 구성돼 있는데 각 필드는 데이터의 형태에 따라 용도에 맞는  
  데이터 타입을 정의해야 한다. 또한 Document는 중첩 구조를 지원하기 떄문에 Document 안에 Document를 지정하는것도 가능하다.
- 필드
  - 문서를 구성하기위한 속성이라고 할 수 있다.  
  일반적으로 데이터베이스의 Column과 비교할수있으나, Column은 정적인 타입인 데 반해 필드는 좀더 동적인 타입이라고 할 수 있다.
- 매핑
  - 매핑은 문서의 필드와 필드의 속성을 정의하고 그에따른 색인방법을 정의하는 프로세스다.
  인덱스의 매핑정보에는 여러가지 데이터 타입을 지정할 수 있지만 필드명은 중복해서 사용할 수 없다.

### 2.1.2 노드의종류
클러스터는 물리적인 노드 인스턴스들의 모임이다.  
분산처리를 위해서는 다양한 형태의 노드들을 조합해서 클러스터를 구성해야 한다.
~~~text
설정에 따라 각 노드는 한 가지 유형으로 동작할 수도 있고 여러 개의 유형을 겸해서 동작할 수도 있다.

# 마스터 노드(Master Node)
- 클러스터를 관리한다.
- 노드 추가와 제거 같은 클러스터의 전반적인 관리를 담당한다.

# 데이터 노드(Data Node)
- 실질적인 데이터를 저장한다.
- 검색과 통계 같은 데이터 관련 작업을 수행한다.

# 코디네이팅 노드(Coordinating Node)
- 사용자의 요청만 받아서 처리한다.
- 클러스터 관련 요청은 마스터 노드에 전달하고 데이터 관련 요청은 데이터 노드에 전달한다.

# 인제스트 노드(Ingest Node)
- 문서의 전처리 작업을 담당한다.
- 인덱스 생선 전 문서의 형식을 다양하게 변경할 수 있다.
~~~

- 마스터 노드
  - 인덱스를 생성, 삭제하는 등 클러스터와 관련된 전반적인 작업을 담당한다.  
  따라서 네트워크 속도가 빠르고 지연이 없는 노드를 마스터 노드로 선정해야 한다.  
  다수의 노드를 마스터 노드로 설정할 수 있지만 결과적으로는 하나의 노드만이 마스터 노드로 선출되어 동작한다.  
  만약 노드를 마스터 노드 전용으로 설정하고자 한다면 elasticsearch.yml 파일을 열고 다음과같이 설정한다.
  ~~~
  node.master: true
  node.data: false
  node.ingest: false
  search.remote.connect: false
  ~~~
  
- 데이터 노드
  - 데이터가 실제로 분산 저장되는 물리적 공간인 샤드가 배치되는 노드이다.  
  색인 작업은 CPU, 메모리, 스토리지 같은 컴퓨팅 리소스를 많이 소모하기 때문에 리소스 모니터링이 필요하다.  
  데이터 노드는 가능한 한 마스터노드와 분리해서 구성하는게 좋으나, 색인할 문서의 수가 적으면 함께 구성해도 상관은 없다.  
  elasticsearch.yml 파일을 열고 다음과같이 설정한다.
  ~~~
  node.master: false
  node.data: true
  node.ingest: false
  search.remote.connect: false
  ~~~
  
- 코디네이팅 노드
  - 들어온 요청을 단순히 라운드로빈 방식으로 분산시켜주는 노드다.  
  elasticsearch.yml 파일을 열고 다음과같이 설정한다.
  ~~~
  node.master: false
  node.data: false
  node.ingest: false
  search.remote.connect: false
  ~~~
  
- 인제스트 노드
  - 색인에 앞서 데이터 전처리하기 위한 노드다.  
  데이터의 포맷을 변경하기 위해 스크립트로 전처리 파이프라인을 구성하고 실행할 수 있다.  
  ~~~
  node.master: false
  node.data: false
  node.ingest: true
  search.remote.connect: false
  ~~~
  
### 2.1.3 클러스터,노드,샤드
